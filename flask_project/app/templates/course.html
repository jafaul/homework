{% extends 'base.html' %}
{% from 'dialogs.html' import add_button %}

{% block title %} {{ title }} {% endblock title %}

{% block content -%}
{{ super() }}

<div class="container">
        <div class="course-header" style="text-align: center; margin-bottom: 50px; margin-top: -20px">
            {% if course.description %}<p>
                <em>{{ course.description }} </em>
            </p> {% endif %}
            <p> <u> Head teacher: {{ course.teacher.name + " " + course.teacher.surname }}</u></p>
        </div>

        <div id="lectures" style="margin-bottom: 70px;" >
            <fieldset id='lectures' class="sub-course-info">
            <legend style="font-size: 30px;"><strong>Lectures</strong></legend>
            {% if lectures %}
                <dl class="items-list">
                {% for lecture in lectures %}
                <dt class='item-dt' style="counter-increment: dt-counter;"><strong>{{ lecture.title }}</strong></dt>
                    {% if lecture.description %}
                        <dd class="sub-item-list"><em>{{ lecture.description }}</em></dd>
                    {% endif %}
                    <hr>
                </dl>

                {% endfor %}
            {% else %}
                <p>No lectures available for this course.</p>
            {% endif %}
                {{ add_button(
                    url_for('add_lectures_to_course',  course_id=course.id),
                    method='get',
                    text='Add a new lecture to this course'
                )
                }}

            </fieldset>
        </div>
        <div>
        <fieldset id="tasks" class="sub-course-info">
            <legend style="font-size: 30px;"><strong>Tasks</strong></legend>
            {% if course.tasks %}
                <dl id="task-list"  class="items-list">
                    {% for task in tasks %}
                        <dt class='item-dt' style="font-size: 20px; text-decoration: underline">
                            <strong>
                                {% if task.title %}
                                {{ task.title }}
                                {% else %}
                                 Task {{ task.id }}
                                {% endif %}
                            </strong></dt>
                        <dd class="sub-item-list"><strong>Max mark: </strong>{{ task.max_mark }}</dd>
                        <dd class="sub-item-list"><strong>Deadline: </strong>{{ task.deadline }}</dd>
                        <hr>
                        <dd class="sub-item-list"><strong>Description:</strong> </dd>
                        <dd  class="sub-item-list" style="margin-top: 10px;">{{ task.description }}</dd>
                        {% if task.answers %}
                            <table  class="table table-condensed">
                            <thead>
                            <tr>
                                <th>Student</th>
                                <th>Student answer</th>
                                <th>Date</th>
                                <th>Mark</th>
                                <th>Teacher</th>
                                <th></th>
                            </tr>
                            </thead>
                            <tbody>
                            {% for answer in task.answers %}
                                <tr>
                                <td>{{ answer.student_name}}</td>
                                <td>{{ answer.description }}</td>
                                <td>{{ answer.submission_date }}</td>
                                <td>{{ answer.mark }}</td>
                                <td>{{ answer.teacher_name }}</td>
                                <td>
                                {% if answer.mark == "Pending to review" %}
                                    {{ add_button(url_for("set_mark", course_id=course.id, task_id=task.id, answer_id=answer.id), "get", "Assign a mark") }}
                                {% endif %}
                                </td>
                                </tr>
                            {% endfor %}
                            </tbody>
                            </table>
                        {% endif %}

                        {{ add_button(url_for("task_answer", course_id=course.id, task_id=task.id), 'get', "Create answer") }}
                    {% endfor %}
                        <hr>
                </dl>
            {% else %}
                <p>No tasks available for this course.</p>
            {% endif %}
             {{ add_button(url_for("task_page", course_id=course.id), 'get', "Add a new task to this course", id="add-task-btn") }}
        </fieldset>
        </div>
    </div>

{% endblock content %}

{% block footer %} {{ super() }}
{%  endblock footer %}